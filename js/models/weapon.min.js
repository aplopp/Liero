define(["underscore","backbone","createjs","settings","projectile","functions/math","functions/color"],function(e,t,n,r,i,s,o){var u=0,a=t.Model.extend({defaults:{name:"Weapon Name",reload:1,speed:500,projectile:"bullet",auto:!1,holdingPlayer:!1,color:"#fff",length:10,width:2,recoil:100,scatter:0},launchProjectile:function(){var e=app.players[this.get("holdingPlayer")],t=e.model.get("facing")==="left"?-1:1,n=e.model.get("aim"),r=s.getPointOnCircle(e.model.get("width")/2,e.model.get("height")/2,this.get("length"),t*n),o=this.get("scatter");if(o)var u=s.getRandomNumberBetween(-o/2,o/2),a=s.getVelocityComponents(this.get("speed"),t*(n+u));else var a=s.getVelocityComponents(this.get("speed"),t*n);var f=new i({x:e.x+r.x,y:e.y+r.y,vX:a.x+e.vX,vY:a.y+e.vY,model:this.get("projectile")});if(recoil=this.get("recoil")){var l=s.getVelocityComponents(recoil,t*(n-180));console.log(recoil,l);e.vX+=l.x;e.vY+=l.y}app.addObject(f)},_delay:!1,fire:function(){var e=this;if(!this._delay){this._delay=!0;setTimeout(function(){e._delay=!1},1e3/this.get("reload"));console.log(u++,this.get("name")+": fired "+this.get("projectile").name);this.launchProjectile()}else console.log(this.get("name")+": too soon to fire ")},_shooting:!1,startShooting:function(){var e=this;if(!this.get("auto"))this.fire();else{e.fire();this._shooting=setInterval(function(){e.fire()},1030/this.get("reload"))}},stopShooting:function(){clearInterval(this._shooting)},initialize:function(){var t=this.get("projectile");e.isString(t)&&this.set("projectile",$.extend({},r.projectiles[t]));this.get("scatter")>90&&this.set("scatter",90)},validate:function(e,t){if(e.scatter>90)return this.get("name")+": Outside accepted limits for scatter."}});return a});