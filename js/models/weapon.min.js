define(["underscore","backbone","createjs","settings","projectile","functions/math","functions/color"],function(e,t,n,r,s,o,u){var a=0,f=t.Model.extend({defaults:{name:"Weapon Name",reload:1,speed:500,projectile:"bullet",auto:!1,recoil:100,scatter:0,holdingPlayer:!1,perShot:1,color:"#fff",length:10,width:2},launchProjectile:function(){var e=app.players[this.get("holdingPlayer")],t=e.model.get("facing")==="left"?-1:1,n=e.model.get("aim"),r=o.getPointOnCircle(e.model.get("width")/2,e.model.get("height")/2,this.get("length"),t*n),u=this.get("scatter"),a=o.getVelocityComponents(this.get("speed"),t*n);for(i=0;i<this.get("perShot");i++){if(u){var f=o.getRandomNumberBetween(-u/2,u/2);a=o.getVelocityComponents(this.get("speed"),t*(n+f))}var l=new s({x:e.x+r.x,y:e.y+r.y,vX:a.x+e.vX,vY:a.y+e.vY,model:this.get("projectile")});app.addObject(l)}if(recoil=this.get("recoil")){var c=o.getVelocityComponents(recoil,t*(n-180));e.vX+=c.x;e.vY+=c.y}},_delay:!1,fire:function(){var e=this;if(!this._delay){this._delay=!0;setTimeout(function(){e._delay=!1},1e3/this.get("reload"));console.log(a++,this.get("name")+": fired "+this.get("perShot")+" "+this.get("projectile").name);this.launchProjectile()}else console.log(this.get("name")+": too soon to fire ")},_shooting:!1,startShooting:function(){var e=this;if(!this.get("auto"))this.fire();else{e.fire();this._shooting=setInterval(function(){e.fire()},1030/this.get("reload"))}},stopShooting:function(){clearInterval(this._shooting)},initialize:function(){var t=this.get("projectile");e.isString(t)&&this.set("projectile",$.extend({},r.projectiles[t]));this.get("scatter")>90&&this.set("scatter",90)},validate:function(e,t){if(e.scatter>90)return this.get("name")+": Outside accepted limits for scatter.";if(e.perShot<1)return this.get("name")+": perShot must be > 0."}});return f});