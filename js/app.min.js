define(["underscore","backbone","jquery","createjs","map","player"],function(e,t,n,r,i,s){function u(){var t=this;this.settings;this.map;this.players;this.stage;this.init=function(e){var t=this;this.settings=e;this.getMap(function(e){t.map=e;t.players=t.createPlayers();t.stage=t.createStage();t.addObjectsToStage();t.start()})};this.getMap=function(e){e=e||o;require(["maps/"+this.settings.map],function(t){e(new i(t))})};this.createPlayers=function(){var t=[];e.each(this.settings.players,function(e){console.log(e);t.push(new s(e))});return t};this.createStage=function(){var e=document.getElementById(this.settings.canvasID);e.width=this.map.settings.width;e.height=this.map.settings.height;return new r.Stage(e)};this.addObjectsToStage=function(){var t=this;e.each(this.players,function(e){var n=e.view.render();t.stage.addChild(n)})};this.nextObjectPositions=function(){var t=this;e.each(this.players,function(e){e.nextPosition();if(e.vX||e.vY){var n=e.model.attributes.width,r=e.model.attributes.height,i=e.model.attributes.x,s=e.model.attributes.y,o=i,u=s,a=e.vX,f=e.vY,l=!0,c=!1,h=!1,p=!1;do{h=c=!1;i>t.map.canvas.width?h=i-t.map.canvas.width:i<0&&(h=i);s>t.map.canvas.height?c=s-t.map.canvas.height:s<0&&(c=s);if(h){p=!0;a*=-1*t.settings.player.bounce;h>0?i=t.map.canvas.width-h*t.settings.player.bounce:i=-h*t.settings.player.bounce}if(c){p=!0;f*=-1*t.settings.player.bounce;f-=t.settings.physics.gravity;if(c>0){var d=u-prev;s=t.map.canvas.height-c*t.settings.player.bounce}else s=-c*t.settings.player.bounce;if(Math.abs(f)<3&&c<1.5){f=0;s=t.map.canvas.height;c=!1}}}while(h||c);if(p){e.vY=f;e.vX=a;e.model.set("x",i);e.model.set("y",s)}}})};this.checkOffX=function(e,t){};this.checkOffY=function(e,t){};this.handleKeyPresses=function(){};this.start=function(){this.ticker=r.Ticker;this.ticker.setFPS(this.settings.FPS);this.ticker.addEventListener("tick",function(){t.handleKeyPresses();t.nextObjectPositions();t.nextFrame()})};this.nextFrame=function(){this.stage.update()}}t.$=n;var o=function(){};return new u});