define(["underscore","backbone","jquery","createjs","map","player"],function(e,t,n,r,i,s){function u(){var t=this;this.settings;this.map;this.players;this.stage;this.init=function(e){var t=this;this.settings=e;this.getMap(function(e){t.map=e;t.players=t.createPlayers();t.stage=t.createStage();t.addObjectsToStage();t.start()})};this.getMap=function(e){e=e||o;require(["maps/"+this.settings.map],function(t){e(new i(t))})};this.createPlayers=function(){var t=[];e.each(this.settings.players,function(e){console.log(e);t.push(new s(e))});return t};this.createStage=function(){var e=document.getElementById(this.settings.canvasID);e.width=this.map.settings.width;e.height=this.map.settings.height;return new r.Stage(e)};this.addObjectsToStage=function(){var t=this;e.each(this.players,function(e){var n=e.view.render();t.stage.addChild(n)})};this.nextObjectPositions=function(){var t=this;e.each(this.players,function(e){e.nextPosition();var n=!1,r=e.model.attributes.x,i=e.vX,s=e.model.attributes.y,o=e.vY,u=offY=!1;do{u=t.checkOffX(r,e.model.attributes.width);offY=t.checkOffY(s,e.model.attributes.height);if(u){n=!0;var a=u<0?0:t.map.canvas.width,f=t.resolveBounceX(a,e.model.attributes.x,e.vX,t.settings.player.bounce);r=f.x;i=f.vX}if(offY){n=!0;var l=offY<0?0:t.map.canvas.height,f=t.resolveBounceY(l,s,o,t.settings.player.bounce);s=f.y;o=f.vY}}while(u||offY);if(n){e.vY=o;e.vX=i;e.model.set("x",r);e.model.set("y",s)}})};this.checkOffX=function(e,n){return e>t.map.canvas.width?e-t.map.canvas.width:e<0?e:!1};this.checkOffY=function(e,n){return e>t.map.canvas.height?e-t.map.canvas.height:e<0?e:!1};this.resolveBounceX=function(e,t,n,r){var i=this.settings.physics.groundFriction;return{x:e-(t-e),vX:-1*r*n}};this.resolveBounceY=function(e,t,n,r){var i=this.settings.physics.gravity,s=this.settings.physics.groundFriction;return{y:e-(t-e),vY:-1*r*n}};this.handleKeyPresses=function(){};this.start=function(){this.ticker=r.Ticker;this.ticker.setFPS(this.settings.FPS);this.ticker.addEventListener("tick",function(){t.handleKeyPresses();t.nextObjectPositions();t.nextFrame()})};this.nextFrame=function(){this.stage.update()}}t.$=n;var o=function(){};return new u});