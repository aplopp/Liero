define(["underscore","backbone","jquery","createjs","map","player"],function(e,t,n,r,i,s){function u(){var t=this;this.settings;this.map;this.players;this.stage;this.init=function(e){var t=this;this.settings=e;this.getMap(function(e){t.map=e;t.players=t.createPlayers();t.stage=t.createStage();t.addObjectsToStage();t.start()})};this.getMap=function(e){e=e||o;require(["maps/"+this.settings.map],function(t){e(new i(t))})};this.createPlayers=function(){var t=[];e.each(this.settings.players,function(e){console.log(e);t.push(new s(e))});return t};this.createStage=function(){var e=document.getElementById(this.settings.canvasID);e.width=this.map.settings.width;e.height=this.map.settings.height;return new r.Stage(e)};this.addObjectsToStage=function(){var t=this;e.each(this.players,function(e){var n=e.view.render();t.stage.addChild(n)})};this.nextObjectPositions=function(){var t=this;e.each(this.players,function(e){e.nextPosition();if(e.vX||e.vY){var n=e.model.attributes.width,r=e.model.attributes.height,i=e.model.attributes.x,s=e.model.attributes.y,o=e.vX,u=e.vY,a=!0,f=!1,l=!1,c=!1;do{l=f=!1;i>t.map.canvas.width?l=i-t.map.canvas.width:i<0&&(l=i);s>t.map.canvas.height?f=s-t.map.canvas.height:s<0&&(f=s);if(l){c=!0;o*=-1*t.settings.player.bounce;l>0?i=t.map.canvas.width-l*t.settings.player.bounce:i=-l*t.settings.player.bounce}if(f){c=!0;u-=t.settings.physics.gravity;u*=-1*t.settings.player.bounce;f>0?s=t.map.canvas.height-f*t.settings.player.bounce:s=-f*t.settings.player.bounce;if(Math.abs(u)<3&&f<1.5){u=0;s=t.map.canvas.height;f=!1}}}while(l||f);if(c){e.vY=u;e.vX=o;e.model.set("x",i);e.model.set("y",s)}}})};this.handleKeyPresses=function(){};this.start=function(){this.ticker=r.Ticker;this.ticker.setFPS(this.settings.FPS);this.ticker.addEventListener("tick",function(){t.handleKeyPresses();t.nextObjectPositions();t.nextFrame()})};this.nextFrame=function(){this.stage.update()}}t.$=n;var o=function(){};return new u});